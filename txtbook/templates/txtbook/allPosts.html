{% extends 'txtbook/base.html' %}

{% load static %}
{% block content %}
<!-- <div class="container-fluid"> -->

  <section class="call-to-action text-white text-center">
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <div class="col-xl-9 mx-auto">
          <h2 class="mb-4">Current Posts </h2>
        </div>
        <div class="col-md-1 col-lg-8 col-xl-7 mx-auto">
        </div>
      </div>
    </div>
  </section>
<br> </br>


<style>
    .my-container {
        border: 1px solid lightgray;
        margin-top: 10px;
    }

    .big-col {
        padding-top: 15px;
        padding-left: 15px;
        padding-right: 15px;
        padding-bottom: 15px;
    }

    .header-row {
        padding-top: 15px;
        padding-left: 15px;
        padding-right: 15px;
        padding-bottom: 2px;
    }

    .my-row {
        padding-top: 15px;
        padding-bottom: 5px;
    }

    .sm-row {
        padding-top: 0px;
        padding-bottom: 7px;
    }

    .big-col {
        padding: 10px;
    }
    .text-left{
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
</style>

<div class="col-md-10 offset-md-2">
    <form class="form" role="form" autocomplete="off" method="GET" action="{% url 'txtbook:filtered_posts_search' %}">
    {% csrf_token %}
        <!-- Search Bar -->
        <div class="row my-row text-left">
            <div class="col-12 col-md-8">
              <input type="search" name = "q" class="form-control form-control-lg" aria-label="Search" placeholder="Search available posts by title, author, or seller email">
            </div>
            <div class="col-3 col-md-2">
              <button type="submit" class="btn btn-block btn-lg btn-primary">Search</button>
            </div>
        </div>

        <!-- Filter -->
        <br><br><u>Filter Options</u>
        <div class="row my-row mx-auto">
            <div class="col-4 my-col">
                <div class="form-row">
                    <div class="col-4 my-col">
                        <label>Sort by date:     </label>
                    </div>
                    <div class="form-check form-check-inline">
                    <label class="form-check-label">
                        <input class="form-check-input" type="radio" name="inlineRadioOptions" id="oldest"
                                value="oldest"> Oldest
                    </label>
                </div>
                <div class="form-check form-check-inline">
                    <label class="form-check-label">
                        <input class="form-check-input" type="radio" name="inlineRadioOptions" id="newest"
                                value="newest" checked="checked"> Newest
                    </label>
                </div>
                    
                </div>
            </div>
            <div class="col-1 my-col">
                
            </div>
            <div class="col-4 my-col">
                <div class="form-row">
                    <div class="col-2 my-col">
                        <label>Class:     </label>
                    </div>
                    <div class="form-group col-md-4">
                        <input type="text" maxlength="4" class="form-control" id="dept" name="dept" placeholder="CS">
                        <small class="text-info">Department</small>
                    </div>
                     <div class="form-group col-md-4">
                        <input type="number" min="0" max="9999" step="0" patter="\*d" class="form-control" id="class_num" name="class_num" placeholder="3240">
                        <small class="text-info">Class number</small>
                    </div>
                    
                </div>
            </div>
        </div>


        <div class="row my-row mx-auto">
            <div class="col-4 my-col">
                <div class="form-row">
                    <div class="col-5 my-col">
                        <label>Maximum Price:     </label>
                    </div>
                    <div class="form-group col-md-6">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="inputGroupPrepend2">$</span>
                            </div>
                            <input type="number" patter="\d*" maxlength="8"  min="0.00" max="10000.00" step="0.01" class="form-control" id="max_price" name="max_price" placeholder="100">
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-1 my-col">
            </div>
            <!-- <div class="col-4 my-col">
                <div class="form-row">
                    <div class="col-5 my-col">
                        <label># of results displayed:     </label>
                    </div>
                    <div class="form-group col-md-5">
                        <input type="number" max="20"  min="1" step="0" class="form-control" id="num_results" name="num_results" value="20">
                        <small class="text-info">Range: 1-20</small>
                    </div>
                </div>
            </div> -->
        </div>
    </form>
</div>
<br>

{% if latest_post_list %}
<ul class="text-center">
    {% for post in latest_post_list %}
    <div class="container my-container">
        <div class="row big-row">
            <div class="col-2 big-col float-left">
                {% if post.image != 'False' %}
                <img src="/media/{{ post.image }}" style="display: block; width: 175px; height: 225px; margin-left: auto; margin-right: auto">
                {% elif post.textbook.user_created == False %}
                <img src="/static/txtbook/thumbnails/{{post.textbook.isbn}}.jpg" style="display: block; width: 175px; height: 225px; margin-left: auto; margin-right: auto">
                {% else %}
                <img src="/media/images/no_image_available.png" style="display: block; width: 175px; height: 225px; margin-left: auto; margin-right: auto">

                {% endif %}
            </div>
            <div class="col-10 big-col">
                <div class="row my-row text-left">
                    <div class="col-10 my-col text-left">
                        <h3 class="text-left"><a href="{% url 'txtbook:post' pk=post.id %}">{{ post.textbook.title }}</a>
                        </h3>
                        {% if user.is_active %}
                            <h6 class="text-left">Contact: {{post.email}}</h6>
                        {% else %}
                            <h6 class="text-left">
                                Contact: <a class="nav-link" href="{% url 'social:begin' 'google-oauth2' %}?next={{ request.path }}">Login to contact</a>
                            </h6>
                        {% endif %}
                        <h7 class="text-left">Posted {{ post.date_published }}</h7>
                    </div>
                </div>
                <div class="row my-row">
                    <div class="col-3 my-col text-left">
                        <h5>Price: ${{ post.price }}</h5>
                        <h6 class='text-left'>Condition: {{ post.condition }} / 5<br>
                            Format: {{ post.format }}</h6>
                    </div>
                    <div class="col-4 my-col text-left">
                        {% if post.textbook.author == '' %}
                        <h5 class="text-left">Author(s): N/A</h5>
                        {% else %}
                        <h5 class="text-left">Author(s): {{post.textbook.author}}</h5>
                        {% endif %}
                        {% if post.textbook.isbn == '' %}
                        <h6 class="text-left">ISBN: N/A</h6>
                        {% else %}
                        <h6 class="text-left">ISBN: {{post.textbook.isbn}}</h6>
                        {% endif %}
                    </div>
                    <div class="col-4 my-col text-left">
                        <h5 class="text-left">
                            {% if post.textbook.dept == '' %}
                            Classes: N/A
                            {% else %}
                            Classes: {{post.textbook.dept}} {{post.textbook.classnum}}
                            {% endif %}
                            <br>
                            {% if post.textbook.sect == '' %}
                            Section: N/A
                            {% else %}
                                {% if post.textbook.sect|length == 1 %}
                                Section: 00{{post.textbook.sect}}
                                {% else %}
                                Section: {{post.textbook.sect}}
                                {% endif %}
                            {% endif %}

                        </h5>
                    </div>

                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</ul>
{% else %}
<p class="text-center">No posts are available.</p>
{% endif %}
<!-- {% include 'txtbook/pagination.html' %} -->
{% if latest_post_list.has_other_pages %}
    <div class="container">
      <ul class="pagination justify-content-center">
        {% if latest_post_list.has_previous %}
          <li class="page-item"><a class ="page-link" href="?page=1&q={{search_term}}" aria-label="First">First</a></li>
          <li class="page-item"><a class ="page-link" aria-label="Previous" href="?page={{ latest_post_list.previous_page_number }}&q={{search_term}}"><<</a></li>
        {% else %}
          <li class="page-item disabled"><a class="page-link"><span>First</span></a></li>
          <li class="page-item disabled"><a class="page-link"><span><<</span></a></li>
        {% endif %}

        {% for i in latest_post_list.paginator.page_range %}
          {% if latest_post_list.number == i %}
            <li class="page-item active"><a class="page-link" href="#"><span>{{ i }} <span class="sr-only">(current)</span></span></a></li>
          {% elif i > latest_post_list.number|add:'-3' and i < latest_post_list.number|add:'3' %}
            <li class="page-item"><a class="page-link" href="?page={{ i }}&q={{search_term}}">{{ i }}</a></li>
          {% endif %}
        {% endfor %}
        {% if latest_post_list.has_next %}
          <li class="page-item"><a class="page-link" aria-label="Next" href="?page={{ latest_post_list.next_page_number }}&q={{search_term}}">>></a></li>
          <li class="page-item"><a class="page-link" aria-label="Last" href="?page={{latest_post_list.paginator.num_pages}}&q={{search_term}}">Last</a></li>
        {% else %}
          <li class="page-item disabled"><a class="page-link"><span>>></span></a></li>
          <li class="page-item disabled"><a class="page-link"><span>Last</span></a></li>
        {% endif %}
      </ul>
    </div>
    {% endif %}

{% endblock %}

<!--https://image.flaticon.com/icons/png/512/130/130304.png-->
